---

- name: Install nginx-related packages
  apt:
    name: '{{ item }}'
    state: 'latest'
    install_recommends: false
  when: item is defined and item
  with_items:
    - 'nginx'
    - '{{ nginx_packages_extra | d() }}'

- name: Divert nginx.conf
  command: dpkg-divert --quiet --local --divert /etc/nginx/nginx.conf.dpkg-divert
           --rename /etc/nginx/nginx.conf creates=/etc/nginx/nginx.conf.dpkg-divert

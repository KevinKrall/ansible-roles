---

- name: Divert default configuration file
  command: dpkg-divert --quiet --local --divert /etc/snmp/snmpd.conf.dpkg-divert --rename /etc/snmp/snmpd.conf
  args:
    creates: '/etc/snmp/snmpd.conf.dpkg-divert'
  notify: [ 'Restart snmpd' ]

- name: Configure snmpd daemon variables
  template:
    src: 'etc/default/snmpd.{{ ansible_os_family }}.j2'
    dest: '{{ snmp_daemon_env_cfg }}'
    owner: root
    group: root
    mode: 0644
    seuser: system_u
    serole: object_r
    setype: etc_t
    selevel: s0
  notify: [ 'Restart snmpd' ]

- name: Configure local SNMP credentials
  template:
    src: 'etc/snmp/snmp.local.conf.j2'
    dest: '/etc/snmp/snmp.local.conf'
    owner: 'root'
    group: 'root'
    mode: '0600'

- name: Create snmpd extension script directory
  file:
    path: '{{ snmpd_extension_scripts }}'
    state: 'directory'
    owner: 'root'
    group: 'root'
    mode: '0755'

- name: Install snmpd extension scripts
  copy:
    src: 'usr/local/lib/snmpd/'
    dest: '{{ snmpd_extension_scripts + "/" }}'
    owner: 'root'
    group: 'root'
    mode: '0755'

- name: Configure snmpd service
  template:
    src: 'etc/snmp/snmpd.conf.j2'
    dest: '/etc/snmp/snmpd.conf'
    owner: 'root'
    group: 'root'
    mode: '0600'
  notify: [ 'Restart snmpd' ]

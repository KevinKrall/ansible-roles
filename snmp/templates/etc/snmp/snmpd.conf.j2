# {{ ansible_managed }}

agentAddress    {{ snmpd_agent_address | join(",") }}

sysName         {{ snmpd_sys_name }}
sysLocation     {{ snmpd_sys_location }}
sysContact      {{ snmpd_sys_contact }}

sysServices     72

{% if snmpd_account_local_username|d() and snmpd_account_local_username %}
createUser      {{ snmpd_account_local_username }} SHA {{ snmpd_account_local_password }} AES {{ snmpd_account_local_password }}
{% endif %}
{% if snmpd_accounts_list|d() and snmpd_accounts_list %}
{% for snmpd_account in snmpd_accounts_list %}
{% if snmpd_account.name|d() and snmpd_account.name and snmpd_account.authPassword|d() and snmpd_account.authPassword and snmpd_account.privPassword|d() and snmpd_account.privPassword %}
createUser      {{ snmpd_account.name }} {% if snmpd_account.authProtocol|d() %}{{ snmpd_account.authProtocol }}{% else %}SHA{% endif %} {{ snmpd_account.authPassword }} {% if snmpd_account.privProtocol|d() %}{{ snmpd_account.privProtocol }}{% else %}AES{% endif %} {{ snmpd_account.privPassword }}
{% endif %}
{% endfor %}
{% endif %}

{% if snmpd_account_local_username|d() and snmpd_account_local_username %}
roUser          {{ snmpd_account_local_username }} priv
{% endif %}
{% if snmpd_accounts_list|d() and snmpd_accounts_list %}
{% for snmpd_account in snmpd_accounts_list %}
roUser          {{ snmpd_account.name }} priv
{% endfor %}
{% endif %}

master agentx

{% if snmpd_load|d() and snmpd_load %}
# CPU load average monitoring
# ===========================
# Profile: {{ snmpd_load_profile }}
# {{ "%-5s = (%s * %-5s * %s" | format("1min", snmpd_load_base, snmpd_load_percent_map[snmpd_load_percent][0] + "%)", snmpd_load_weight_map[snmpd_load_weight][0]) }}
# {{ "%-5s = (%s * %-5s * %s" | format("5min", snmpd_load_base, snmpd_load_percent_map[snmpd_load_percent][1] + "%)", snmpd_load_weight_map[snmpd_load_weight][1]) }}
# {{ "%-5s = (%s * %-5s * %s" | format("15min", snmpd_load_base, snmpd_load_percent_map[snmpd_load_percent][2] + "%)", snmpd_load_weight_map[snmpd_load_weight][2]) }}

load {{ snmpd_load_1min }} {{ snmpd_load_5min }} {{ snmpd_load_15min }}
{% endif %}

# Extension scripts
# =================

# LibreNMS - Operating System release detection
extend .1.3.6.1.4.1.2021.7890.1 distro {{ snmpd_extension_scripts }}/os-release
